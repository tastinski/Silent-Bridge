import streamlit as st
import google.generativeai as genai

# --- –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–ª—é—á –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–æ—Å–∏–º –≤–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é
if "GOOGLE_API_KEY" in st.secrets:
    GOOGLE_API_KEY = st.secrets["GOOGLE_API_KEY"]
else:
    GOOGLE_API_KEY = st.text_input("üîê –í–≤–µ–¥–∏ —Å–≤–æ–π Google API Key:", type="password")

if not GOOGLE_API_KEY:
    st.info("üëà –í–≤–µ–¥–∏ –∫–ª—é—á, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ò–ò-–º–æ–∑–≥.")
    st.stop()

genai.configure(api_key=GOOGLE_API_KEY)

# --- –£–ú–ù–´–ô –ë–õ–û–ö: –ê–í–¢–û-–ü–û–ò–°–ö –ú–û–î–ï–õ–ò ---
# –ú—ã –Ω–µ –≥–∞–¥–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ, –º—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ–º —É Google, —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —Ç–≤–æ–µ–≥–æ –∫–ª—é—á–∞
def get_best_model():
    try:
        available_models = []
        for m in genai.list_models():
            if 'generateContent' in m.supported_generation_methods:
                available_models.append(m.name)
        
        # 1. –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å–∞–º—É—é –±—ã—Å—Ç—Ä—É—é (Flash)
        flash_model = next((m for m in available_models if 'flash' in m and '1.5' in m), None)
        if flash_model: return flash_model
        
        # 2. –ï—Å–ª–∏ –Ω–µ—Ç Flash 1.5, –∏—â–µ–º –ª—é–±—É—é Flash
        any_flash = next((m for m in available_models if 'flash' in m), None)
        if any_flash: return any_flash
        
        # 3. –ï—Å–ª–∏ –Ω–µ—Ç Flash, –±–µ—Ä–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é Pro
        pro_model = next((m for m in available_models if 'pro' in m), None)
        if pro_model: return pro_model
        
        # 4. –ï—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω—è—Ç–Ω–æ, –±–µ—Ä–µ–º –ø–µ—Ä–≤—É—é –ø–æ–ø–∞–≤—à—É—é—Å—è
        return available_models[0] if available_models else "gemini-pro"
        
    except Exception as e:
        # –ï—Å–ª–∏ —Å–æ–≤—Å–µ–º –±–µ–¥–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä—É—é –Ω–∞–¥–µ–∂–Ω—É—é –∫–ª–∞—Å—Å–∏–∫—É
        return "gemini-pro"

# –ü–æ–ª—É—á–∞–µ–º —Ä–∞–±–æ—á—É—é –º–æ–¥–µ–ª—å
MODEL_NAME = get_best_model()
model = genai.GenerativeModel(MODEL_NAME)

# --- –ò–ù–¢–ï–†–§–ï–ô–° ---
st.set_page_config(page_title="Silent Bridge AI", page_icon="üåâ")
st.title("üåâ Silent Bridge: AI Analytics")

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–ª—è —Ç–≤–æ–µ–≥–æ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è)
st.caption(f"üöÄ –ü–æ–¥–∫–ª—é—á–µ–Ω –º–æ–∑–≥: **{MODEL_NAME}**")

def analyze_with_ai(text):
    prompt = f"""
    –¢—ã - –æ–ø—ã—Ç–Ω—ã–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫ (–†–ê–°, –Ω–µ–≤—Ä–æ–ª–æ–≥–∏—è).
    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—ã–ø–∏—Å–∫—É –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è:
    "{text}"
    
    –¢—ã ‚Äî Silent Bridge AI, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –±–∏–æ—Ö–∏–º–∏–∏ –Ω–µ–π—Ä–æ–≤–æ—Å–ø–∞–ª–µ–Ω–∏–π –∏ –º–µ—Ç–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—é.
    –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å–∫–∞–∑–∞—Ç—å –¥–∏–∞–≥–Ω–æ–∑, –∞ –Ω–∞–π—Ç–∏ "–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫—É—é –ø–æ–ª–æ–º–∫—É" –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ —Ä–µ–±–µ–Ω–∫–∞.
    
    –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: "{text}"
    
    –î–∞–π –∂–µ—Å—Ç–∫–∏–π, –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π —Ä–∞–∑–±–æ—Ä –ø–æ –ø—É–Ω–∫—Ç–∞–º:
    
    1. üîß **–ì–¥–µ —Å–ª–æ–º–∞–ª—Å—è –º–µ—Ö–∞–Ω–∏–∑–º?**
    (–ù–µ –ø–∏—à–∏ "–ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–≤–∏—Ç–∏—è". –ü–∏—à–∏: "–ù–∞—Ä—É—à–µ–Ω –≤—ã–≤–æ–¥ —Ç–æ–∫—Å–∏–Ω–æ–≤ –∏–∑-–∑–∞ –∑–∞—Å—Ç–æ—è –∂–µ–ª—á–∏" –∏–ª–∏ "–ì–∏–ø–æ–∫—Å–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –º–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–π (—ç–Ω–µ—Ä–≥–æ—Å—Ç–∞–Ω—Ü–∏–π –∫–ª–µ—Ç–æ–∫)").
    
    2. üß¨ **–ë–∏–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤**
    (–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è B12/–§–æ–ª–∞—Ç–æ–≤ ‚Äî –ø–∏—à–∏: "–ü–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª–æ–º–∫—É —Ñ–æ–ª–∞—Ç–Ω–æ–≥–æ —Ü–∏–∫–ª–∞". –ï—Å–ª–∏ –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏ ‚Äî –ø–∏—à–∏: "–†–∏—Å–∫ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –º–∏–∫—Ä–æ–±–∏–æ–º–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω").
    
    3. üó∫Ô∏è **–ö–∞—Ä—Ç–∞ "–ß—Ç–æ –∫ —á–µ–º—É –ø—Ä–∏–≤–æ–¥–∏—Ç"**
    (–ü–æ—Å—Ç—Ä–æ–π —Ü–µ–ø–æ—á–∫—É: –°–∏–º–ø—Ç–æ–º –ê -> –≤—ã–∑—ã–≤–∞–µ—Ç –°–±–æ–π –ë -> –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –î–∏–∞–≥–Ω–æ–∑—É –í).
    
    4. üí° **–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ–º–æ–Ω—Ç–∞ (–õ–æ–≥–∏–∫–∞)**
    (–ù–µ –¥–∞–≤–∞–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Å–æ–≤–µ—Ç–æ–≤! –ü–∏—à–∏ –ª–æ–≥–∏–∫—É: "–ß—Ç–æ–±—ã –ø–æ—á–∏–Ω–∏—Ç—å —Ä–µ—á—å, –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —É–±—Ä–∞—Ç—å –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –≤ –∫–∏—à–µ—á–Ω–∏–∫–µ, –∏–Ω–∞—á–µ –≤–∏—Ç–∞–º–∏–Ω—ã –Ω–µ —É—Å–≤–æ—è—Ç—Å—è").
    
    –ü–∏—à–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ, –±–µ–∑ –≤–æ–¥—ã, –∫–∞–∫ –∏–Ω–∂–µ–Ω–µ—Ä –∏–Ω–∂–µ–Ω–µ—Ä—É.
    """
    try:
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        return f"–û—à–∏–±–∫–∞ ({MODEL_NAME}): {e}"
        st.warning("–°–Ω–∞—á–∞–ª–∞ –≤—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç!")
    else:
        with st.spinner(f"–ò–ò ({MODEL_NAME}) —á–∏—Ç–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç..."):
            res = analyze_with_ai(text_input)
            st.markdown("---")
            st.markdown(res)
